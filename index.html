<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Waterfall.js</title>
    <link rel="stylesheet" href="waterfall.css">
</head>
<body>
    <section>
        <header>
            <p class="signature">Made by <a href="http://github.com/raphamorim"><span>@raphamorim</span></a></p>
            <h1>Waterfall.js</h1>
            <h2>Pinterest Grid</h2>
            <h3>Status: Unstable</h3>
        </header>
    </section>
    <section>
        <div class="waterfall">
            <div class="item">1</div>
            <div class="item">2</div>
            <div class="item">3</div>
            <div class="item">4</div>
            <div class="item">5</div>
            <div class="item">6</div>
            <div class="item">7</div>
            <div class="item">8</div>
            <div class="item">9</div>
            <div class="item">10</div>
            <div class="item">11</div>
            <div class="item">12</div>
            <div class="item">13</div>
            <div class="item">14</div>
            <div class="item">15</div>
            <div class="item">16</div>
            <div class="item">17</div>
        </div>
    </section>
    <section>
        <!-- Get Started  -->
    </section>
    <script src="waterfall.js"></script>
    <script>
    function waterfall(container){
        var els = [].map.call(container.children, function(el){
            el.style.position = 'absolute';
            return el;
        });
        container.style.position = 'relative';

        function px(n){ return n + 'px';}

        function y(el){ return el? parseFloat(el.style.top) || 0 : 0; }
        function x(el){ return el? parseFloat(el.style.left) || 0 : 0; }
        function width(el){ return el? el.clientWidth : 0; }
        function height(el){ return el? el.clientHeight : 0; }
        function bottom(el){ return y(el) + height(el);}
        function right(el){ return x(el) + width(el);}

        function sort(l){
          l = l.sort(function(a, b){
            if(bottom(a) === bottom(b)){
              return x(b) - x(a);
            }else{
              return bottom(b) - bottom(a);
            }
          })
        }

        var border = [];

        for(var i = 0; i < els.length; i++){
          var prev = els[i - 1],
              el = els[i],
              thereIsSpace = right(prev) + width(el) <= width(container);

          if(!thereIsSpace) break;
          el.style.top = px(y(prev));
          el.style.left = px(right(prev));
          border.push(el);
        }

        for(; i < els.length; i++){
          var el = els[i];
          sort(border)
          var minEl = border.pop();
          el.style.top = px(bottom(minEl));
          el.style.left = px(x(minEl));
          border.push(el);
        };

        container.style.height = px(Math.max.apply(Math, border.map(bottom)));
    }

    var container = document.querySelector('.waterfall');
    waterfall(container);

    </script>
</body>
</html>
