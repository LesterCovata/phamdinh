<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Waterfall.js</title>
    <link rel="stylesheet" href="waterfall.css">
</head>
<body>
    <section>
        <header>
            <p class="signature">Made by <a href="http://github.com/raphamorim"><span>@raphamorim</span></a></p>
            <h1>Waterfall.js</h1>
            <h2>Pinterest Grid</h2>
            <h3>Status: Unstable</h3>
        </header>
    </section>
    <section>
        <div class="waterfall">
            <div class="item">1</div>
            <div class="item">2</div>
            <div class="item">3</div>
            <div class="item">4</div>
            <div class="item">5</div>
            <div class="item">6</div>
            <div class="item">7</div>
            <div class="item">8</div>
            <div class="item">9</div>
            <div class="item">10</div>
            <div class="item">11</div>
            <div class="item">12</div>
            <div class="item">13</div>
            <div class="item">14</div>
            <div class="item">15</div>
            <div class="item">16</div>
            <div class="item">17</div>
        </div>
    </section>
    <section>
        <!-- Get Started  -->
    </section>
    <script src="waterfall.js"></script>
    <script>
    function waterfall(container){
        // Freeze the list of nodes
        var els = [].map.call(container.children, function(el){
            el.style.position = 'absolute';
            return el;
        });
        container.style.position = 'relative';

        function px(n){ return n + 'px';}

        function margin(name, el){
          var style = window.getComputedStyle(el);
          return parseFloat(style['margin' + name]) || 0;
        }
        function y(el){ return parseFloat(el.style.top) ; }
        function x(el){ return parseFloat(el.style.left); }
        function width(el){ return el.clientWidth; }
        function height(el){ return el.clientHeight; }
        function bottom(el){ return y(el) + height(el) + margin('Bottom', el);}
        function right(el){ return x(el) + width(el) + margin('Right', el);}

        function sort(l){
          l = l.sort(function(a, b){
            if(bottom(a) === bottom(b)){
              return x(b) - x(a);
            }else{
              return bottom(b) - bottom(a);
            }
          })
        }

        var boundary = [];
        if(els.length){
          els[0].style.top = '0px';
          els[0].style.left = px(margin('Left', els[0]));
          boundary.push(els[0]);
        }

        for(var i = 1; i < els.length; i++){
            var prev = els[i - 1],
                el = els[i],
                thereIsSpace = right(prev) + width(el) <= width(container);
            if(!thereIsSpace) break;
            el.style.top = prev.style.top;
            el.style.left = px(right(prev) + margin('Left', el));
          boundary.push(el);
        }

        for(; i < els.length; i++){
          sort(boundary)
          var el = els[i],
              minEl = boundary.pop();
          el.style.top = px(bottom(minEl) + margin('Top', el));
          el.style.left = px(x(minEl));
          boundary.push(el);
        };

        container.style.height = px(bottom(boundary[0]) + margin('Bottom', boundary[0]));
    }

    var container = document.querySelector('.waterfall');
    waterfall(container);

    </script>
</body>
</html>
